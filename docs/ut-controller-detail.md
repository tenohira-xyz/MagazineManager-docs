# 雑誌詳細画面コントローラクラスの単体テスト

## 非ログイン状態で初期表示（雑誌が存在する）
### 条件
- 匿名ユーザ
- `/detail/1`にGETリクエストを送信する。

### 確認事項
1. サービス層のモックを作成する。
|クラス|メソッド|引数|戻り値|
|:--|:--|:--|:--|
|雑誌サービスクラス|存在チェックメソッド（雑誌ID）|1|true|
|雑誌サービスクラス|単一レコード取得メソッド|1|雑誌オブジェクト|
    - 雑誌オブジェクトの内容
    |雑誌名|号数|
    |:--|:--|
    |テスト雑誌|No.123|
1. HTTPステータスがOK(200)となることを確認する。
1. `detail.html`をビューとして返すことを確認する。
1. 表示内容を確認する。
1. サービス層のメソッドの呼び出しを検証する。
|クラス|メソッド|呼び出し回数|
|:--|:--|:--|
|雑誌サービスクラス|存在チェックメソッド（雑誌ID）|1|
|雑誌サービスクラス|単一レコード取得メソッド|1|

## 非ログイン状態で初期表示（雑誌が存在しない）
### 条件
- 匿名ユーザ
- `/detail/1`にGETリクエストを送信する。

### 確認事項
1. サービス層のモックを作成する。
|クラス|メソッド|引数|戻り値|
|:--|:--|:--|:--|
|雑誌サービスクラス|存在チェックメソッド（雑誌ID）|1|false|
1. HTTPステータスがOK(200)となることを確認する。
1. モデルに登録したパラメータにエラーメッセージが含まれているか検証する。
|名前|内容|
|:--|:--|
|status|500|
|error|エラー|
|message|指定した雑誌が存在しません。|
1. `error.html`をビューとして返すことを確認する。
1. 発生した例外が[雑誌非存在例外](exception.md#雑誌非存在例外)かを検証する。
1. サービス層のメソッドの呼び出しを検証する。
|クラス|メソッド|呼び出し回数|
|:--|:--|:--|
|雑誌サービスクラス|存在チェックメソッド（雑誌ID）|1|
|雑誌サービスクラス|単一レコード取得メソッド|0|

## 非ログイン状態で更新
### 条件
- 匿名ユーザ
- `/detail/1/update`にPOSTリクエストを送信する。
|パラメータ名|値|
|:--|:--|
|name||

### 確認事項
1. HTTPステータスがForbidden(403)となることを確認する。
1. サービス層のメソッドの呼び出しを検証する。
|クラス|メソッド|呼び出し回数|
|:--|:--|:--|
|雑誌サービスクラス|存在チェックメソッド（雑誌ID）|0|
|雑誌サービスクラス|更新メソッド|0|

## 管理者権限で初期表示（雑誌が存在する）
### 条件
- 管理者ユーザ
- `/detail/1`にGETリクエストを送信する。

### 確認事項
1. サービス層のモックを作成する。
|クラス|メソッド|引数|戻り値|
|:--|:--|:--|:--|
|雑誌サービスクラス|存在チェックメソッド（雑誌ID）|1|true|
|雑誌サービスクラス|単一レコード取得メソッド|1|雑誌オブジェクト|
    - 雑誌オブジェクトの内容
    |雑誌名|号数|
    |:--|:--|
    |テスト雑誌|No.123|
1. HTTPステータスがOK(200)となることを確認する。
1. `detail.html`をビューとして返すことを確認する。
1. 表示内容を確認する。
1. サービス層のメソッドの呼び出しを検証する。
|クラス|メソッド|呼び出し回数|
|:--|:--|:--|
|雑誌サービスクラス|存在チェックメソッド（雑誌ID）|1|
|雑誌サービスクラス|単一レコード取得メソッド|1|

## 管理者権限で初期表示（雑誌が存在しない）
### 条件
- 管理者ユーザ
- `/detail/1`にGETリクエストを送信する。

### 確認事項
1. サービス層のモックを作成する。
|クラス|メソッド|引数|戻り値|
|:--|:--|:--|:--|
|雑誌サービスクラス|存在チェックメソッド（雑誌ID）|1|false|
1. HTTPステータスがOK(200)となることを確認する。
1. モデルに登録したパラメータにエラーメッセージが含まれているか検証する。
|名前|内容|
|:--|:--|
|status|500|
|error|エラー|
|message|指定した雑誌が存在しません。|
1. `detail.html`をビューとして返すことを確認する。
1. 発生した例外が[雑誌非存在例外](exception.md#雑誌非存在例外)かを検証する。
1. サービス層のメソッドの呼び出しを検証する。
|クラス|メソッド|呼び出し回数|
|:--|:--|:--|
|雑誌サービスクラス|存在チェックメソッド（雑誌ID）|1|
|雑誌サービスクラス|単一レコード取得メソッド|0|

## 入力チェック（必須入力）
### 条件
- 管理者ユーザ
- `/detail/1/update`にPOSTリクエストを送信する。
|パラメータ名|値|
|:--|:--|
|magazineId|1|
|name||
|number||
|publisher||
|issueDate||

### 確認事項
1. サービス層のモックを作成する。
|クラス|メソッド|引数|戻り値|
|:--|:--|:--|:--|
|雑誌サービスクラス|存在チェックメソッド（雑誌ID）|1|true|
|雑誌サービスクラス|更新メソッド|雑誌オブジェクト|false|
    - 雑誌オブジェクトの内容
    |雑誌ID|雑誌名|号数|出版社|発行日|
    |:--|:--|:--|:--|:--|
    |1|||||
1. `detail.html`をビューとして返すことを確認する。
1. エラーメッセージ数が4であることを確認する。
1. 想定通りのエラーメッセージが出力されていることを確認する。
    - 雑誌名が入力されていません。
    - 号数が入力されていません。
    - 出版社が入力されていません。
    - 発行日が入力されていません。
1. サービス層のメソッドの呼び出しを検証する。
|クラス|メソッド|呼び出し回数|
|:--|:--|:--|
|雑誌サービスクラス|存在チェックメソッド（雑誌ID）|1|
|雑誌サービスクラス|更新メソッド|0|

## 入力チェック（文字列長：1文字）
### 条件
- 管理者ユーザ
- `/detail/1/update`にPOSTリクエストを送信する。
|パラメータ名|値|
|:--|:--|
|magazineId|1|
|name|あ|
|number|い|
|publisher|う|
|issueDate|2020-01-01|

### 確認事項
1. サービス層のモックを作成する。
|クラス|メソッド|引数|戻り値|
|:--|:--|:--|:--|
|雑誌サービスクラス|存在チェックメソッド（雑誌ID）|1|true|
|雑誌サービスクラス|更新メソッド|雑誌オブジェクト|false|
    - 雑誌オブジェクトの内容
    |雑誌ID|雑誌名|号数|出版社|発行日|
    |:--|:--|:--|:--|:--|
    |1|あ|い|う|2020-01-01|
1. `error.html`をビューとして返すことを確認する。
1. エラーメッセージ数が0であることを確認する。
1. サービス層のメソッドの呼び出しを検証する。
|クラス|メソッド|呼び出し回数|
|:--|:--|:--|
|雑誌サービスクラス|存在チェックメソッド（雑誌ID）|1|
|雑誌サービスクラス|更新メソッド|1|

## 入力チェック（文字列長：最大数）
### 条件
- 管理者ユーザ
- `/detail/1/update`にPOSTリクエストを送信する。
|パラメータ名|値|
|:--|:--|
|magazineId|1|
|name|あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほ|
|number|あいうえおかきくけこさしすせそたちつてと|
|publisher|あいうえおかきくけこさしすせそたちつてと|
|issueDate|2020-01-01|

### 確認事項
1. サービス層のモックを作成する。
|クラス|メソッド|引数|戻り値|
|:--|:--|:--|:--|
|雑誌サービスクラス|存在チェックメソッド（雑誌ID）|1|true|
|雑誌サービスクラス|更新メソッド|雑誌オブジェクト|false|
    - 雑誌オブジェクトの内容
    |雑誌ID|雑誌名|号数|出版社|発行日|
    |:--|:--|:--|:--|:--|
    |1|あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほ|あいうえおかきくけこさしすせそたちつてと|あいうえおかきくけこさしすせそたちつてと|2020-01-01|
1. `error.html`をビューとして返すことを確認する。
1. エラーメッセージ数が0であることを確認する。
1. サービス層のメソッドの呼び出しを検証する。
|クラス|メソッド|呼び出し回数|
|:--|:--|:--|
|雑誌サービスクラス|存在チェックメソッド（雑誌ID）|1|
|雑誌サービスクラス|更新メソッド|1|

## 入力チェック（文字列長：超過）
### 条件
- 管理者ユーザ
- `/detail/1/update`にPOSTリクエストを送信する。
|パラメータ名|値|
|:--|:--|
|magazineId|1|
|name|あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほま|
|number|あいうえおかきくけこさしすせそたちつてとな|
|publisher|あいうえおかきくけこさしすせそたちつてとな|
|issueDate|2020-01-01|

### 確認事項
1. サービス層のモックを作成する。
|クラス|メソッド|引数|戻り値|
|:--|:--|:--|:--|
|雑誌サービスクラス|存在チェックメソッド（雑誌ID）|1|true|
|雑誌サービスクラス|更新メソッド|雑誌オブジェクト|false|
    - 雑誌オブジェクトの内容
    |雑誌ID|雑誌名|号数|出版社|発行日|
    |:--|:--|:--|:--|:--|
    |1|あいうえおかきくけこさしすせそたちつてとなにぬねのはひふへほま|あいうえおかきくけこさしすせそたちつてとな|あいうえおかきくけこさしすせそたちつてとな|2020-01-01|
1. `detail.html`をビューとして返すことを確認する。
1. エラーメッセージ数が3であることを確認する。
1. 想定通りのエラーメッセージが出力されていることを確認する。
    - 雑誌名は30文字以内で入力してください。
    - 号数は20文字以内で入力してください。
    - 出版社は20文字以内で入力してください。
1. サービス層のメソッドの呼び出しを検証する。
|クラス|メソッド|呼び出し回数|
|:--|:--|:--|
|雑誌サービスクラス|存在チェックメソッド（雑誌ID）|1|
|雑誌サービスクラス|更新メソッド|0|

## 入力チェック（日付）
### 条件
- 管理者ユーザ
- `/detail/1/update`にPOSTリクエストを送信する。
|パラメータ名|値|
|:--|:--|
|magazineId|1|
|name|テスト雑誌|
|number|No.123|
|publisher|テスト出版社|
|issueDate|123|

### 確認事項
1. サービス層のモックを作成する。
|クラス|メソッド|引数|戻り値|
|:--|:--|:--|:--|
|雑誌サービスクラス|存在チェックメソッド（雑誌ID）|1|true|
|雑誌サービスクラス|更新メソッド|雑誌オブジェクト|false|
    - 雑誌オブジェクトの内容
    |雑誌ID|雑誌名|号数|出版社|発行日|
    |:--|:--|:--|:--|:--|
    |1|テスト雑誌|No.123|テスト出版社|123|
1. `detail.html`をビューとして返すことを確認する。
1. エラーメッセージ数が1であることを確認する。
1. 想定通りのエラーメッセージが出力されていることを確認する。
    - 発行日はyyyy/MM/dd形式で入力してください。
1. サービス層のメソッドの呼び出しを検証する。
|クラス|メソッド|呼び出し回数|
|:--|:--|:--|
|雑誌サービスクラス|存在チェックメソッド（雑誌ID）|1|
|雑誌サービスクラス|更新メソッド|0|

## 管理者権限で更新（成功）
### 条件
- 管理者ユーザ
- `/detail/1/update`にPOSTリクエストを送信する。
|パラメータ名|値|
|:--|:--|
|magazineId|1|
|name|テスト雑誌|
|number|No.123|
|publisher|テスト出版社|
|issueDate|2020-01-01|

### 確認事項
1. サービス層のモックを作成する。
|クラス|メソッド|引数|戻り値|
|:--|:--|:--|:--|
|雑誌サービスクラス|存在チェックメソッド（雑誌ID）|1|true|
|雑誌サービスクラス|更新メソッド|雑誌オブジェクト|true|
    - 雑誌オブジェクトの内容
    |雑誌ID|雑誌名|号数|出版社|発行日|
    |:--|:--|:--|:--|:--|
    |1|テスト雑誌|No.123|テスト出版社|2020-01-01|
1. HTTPステータスがFound(302)となることを確認する。
1. `magazineList.html`をビューとして返すことを確認する。
1. サービス層のメソッドの呼び出しを検証する。
|クラス|メソッド|呼び出し回数|
|:--|:--|:--|
|雑誌サービスクラス|存在チェックメソッド（雑誌ID）|1|
|雑誌サービスクラス|更新メソッド|1|

## 管理者権限で更新（失敗）
### 条件
- 管理者ユーザ
- `/detail/1/update`にPOSTリクエストを送信する。
|パラメータ名|値|
|:--|:--|
|magazineId|1|
|name|テスト雑誌|
|number|No.123|
|publisher|テスト出版社|
|issueDate|2020-01-01|

### 確認事項
1. サービス層のモックを作成する。
|クラス|メソッド|引数|戻り値|
|:--|:--|:--|:--|
|雑誌サービスクラス|存在チェックメソッド（雑誌ID）|1|true|
|雑誌サービスクラス|更新メソッド|雑誌オブジェクト|false|
    - 雑誌オブジェクトの内容
    |雑誌ID|雑誌名|号数|出版社|発行日|
    |:--|:--|:--|:--|:--|
    |1|テスト雑誌|No.123|テスト出版社|2020-01-01|
1. HTTPステータスがOK(200)となることを確認する。
1. `error.html`をビューとして返すことを確認する。
1. サービス層のメソッドの呼び出しを検証する。
|クラス|メソッド|呼び出し回数|
|:--|:--|:--|
|雑誌サービスクラス|存在チェックメソッド（雑誌ID）|1|
|雑誌サービスクラス|更新メソッド|1|

## 管理者権限で更新（例外）
### 条件
- 管理者ユーザ
- `/detail/1/update`にPOSTリクエストを送信する。
|パラメータ名|値|
|:--|:--|
|magazineId|1|
|name|テスト雑誌|
|number|No.123|
|publisher|テスト出版社|
|issueDate|2020-01-01|

### 確認事項
1. サービス層のモックを作成する。
|クラス|メソッド|引数|戻り値|
|:--|:--|:--|:--|
|雑誌サービスクラス|存在チェックメソッド（雑誌ID）|1|false|
1. HTTPステータスがOK(200)となることを確認する。
1. モデルに登録したパラメータにエラーメッセージが含まれているか検証する。
|名前|内容|
|:--|:--|
|status|500|
|error|エラー|
|message|指定した雑誌が存在しません。|
1. `error.html`をビューとして返すことを確認する。
1. 発生した例外が[雑誌非存在例外](exception.md#雑誌非存在例外)かを検証する。
1. サービス層のメソッドの呼び出しを検証する。
|クラス|メソッド|呼び出し回数|
|:--|:--|:--|
|雑誌サービスクラス|存在チェックメソッド（雑誌ID）|1|
|雑誌サービスクラス|更新メソッド|0|

